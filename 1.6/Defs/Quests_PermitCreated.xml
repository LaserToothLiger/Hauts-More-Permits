<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <!--rover branch Find permits-->
  <QuestScriptDef>
    <defName>HVMP_ItemStash</defName>
    <rootSelectionWeight>0</rootSelectionWeight>
    <rootMinPoints>0</rootMinPoints>
    <autoAccept>true</autoAccept>
    <questNameRules>
      <rulesStrings>
        <li>questName->[stash] of [treasure]</li>
        <li>stash->Stash</li>
        <li>stash->Cache</li>
        <li>stash->Collection</li>
        <li>stash->Shack</li>
        <li>treasure->Treasure</li>
        <li>treasure->Valuables</li>
        <li>treasure->Fortune</li>
        <li>treasure->Goodies</li>
        <li>treasure->Supplies</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The Rover Branch has informed us of a collection of valuable items worth [itemStashContentsValue] not far from [map_definite]. The collection consists of:\n\n[itemStashContents]\n\nIt seems that [allSitePartsDescriptionsExceptFirst]</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />
        <li Class="QuestNode_Set">
          <name>siteDistRange</name>
          <value>2~13</value>
        </li>
        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
          <selectLandmarkChance>0.5</selectLandmarkChance>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.65</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>ItemStash</tag>
            </li>
            <li>
              <tag>ItemStashQuestThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
          <parms>
            <hiddenSitePartsPossible>false</hiddenSitePartsPossible>
          </parms>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(12,28)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The Rover Branch indicates the item stash has been claimed by others. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_AddItemsReward">
          <items>$generatedItemStashThings</items>
          <inSignalChoiceUsed>site.MapGenerated</inSignalChoiceUsed>
          <generateQuestParts>false</generateQuestParts>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
  <QuestScriptDef>
    <defName>HVMP_MineralLump</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->[lump] of [targetMineableThing_label]</li>
        <li>questName->[targetMineableThing_label] [lump]</li>
        <li>questName->The [targetMineableThing_label] [lump]</li>
        <li>questName->[adj] [targetMineableThing_label]</li>
        <li>questName->[targetMineableThing_label] [discovered]</li>

        <li>lump->lump</li>
        <li>lump->pile</li>
        <li>lump->deposit</li>
        <li>lump->seam</li>
        <li>lump->chunk</li>
        <li>lump->pile</li>

        <li>adj->distant</li>
        <li>adj->far</li>
        <li>adj->new</li>
        <li>adj->meteoric</li>

        <li>discovered->discovered</li>
        <li>discovered->observed</li>
        <li>discovered->found</li>
        <li>discovered->surveyed</li>

      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The Rover Branch has informed us of a lump of [targetMineable_label] nearby.\n\nUnfortunately, it won't last - others will mine it first in [timeoutTicks_duration] if we don't.[lumpThreatDescription]</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_Set">
          <name>siteDistRange</name>
          <value>2~13</value>
        </li>
        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
          <selectLandmarkChance>0.05</selectLandmarkChance>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.5</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>PreciousLump</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_Set">
          <name>timeoutTicks</name>
          <value>$(30*60000)</value>
        </li>
        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <delayTicks>$timeoutTicks</delayTicks>
          <isQuestTimeout>true</isQuestTimeout>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">Others have mined the lump of [targetMineable_label]. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
	<modExtensions>
	  <li Class="HautsFramework.LumpQuest" />
	</modExtensions>
  </QuestScriptDef>
  <QuestScriptDef>
    <defName>HVMP_RescueePrisoner</defName>
    <rootSelectionWeight>0</rootSelectionWeight>
    <rootMinPoints>0</rootMinPoints>
    <rootIncreasesPopulation>true</rootIncreasesPopulation>
    <autoAccept>true</autoAccept>
    <questNameRules>
      <rulesStrings>
        <li>questName->[prisoner_nameDef]'s Salvation</li>
        <li>questName->[prisoner_nameDef]'s Rescue</li>
        <li>questName->[prisoner_nameDef]'s Breakout</li>
        <li>questName->Rescuing [prisoner_nameDef]</li>
        <li>questName->Saving [prisoner_nameDef]</li>
        <li>questName->Breaking [prisoner_nameDef] Out</li>
        <li>questName->Liberating [prisoner_nameDef]</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The Rover Branch has informed us of a distress call from a prisoner being held by [siteFaction_name].
\n[prisoner_nameDef] is being held at a camp near [map_definite][underArmedGuard]. [prisoner_pronoun] will join whoever rescues [prisoner_objective]. [prisoner_pronoun] is a [prisoner_age]-year-old [prisoner_title]. [prisoner_pronoun] says that [allSitePartsDescriptionsExceptFirst][formerColonistInfo][prisonerFullRelationInfo]
\nIf you miss this opportunity, you may never hear from [prisoner_nameDef] again.</li>
        <li>formerColonistInfo(priority=1)->\n\n[prisoner_formerlyColonistInfo]</li>
        <li>formerColonistInfo-></li>
        <li>underArmedGuard(allowViolentQuests==true,priority=1)-> under armed guard</li>
        <li>underArmedGuard-></li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />
        <li Class="QuestNode_Set">
          <name>siteDistRange</name>
          <value>2~13</value>
        </li>
        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
          <selectLandmarkChance>0.5</selectLandmarkChance>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>          
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>PrisonerWillingToJoin</tag>
            </li>
            <li>
              <tag>PrisonerRescueQuestThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
          <parms>
            <hiddenSitePartsPossible>true</hiddenSitePartsPossible>
          </parms>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
          <defsToExcludeFromHyperlinks>Human</defsToExcludeFromHyperlinks>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(12,28)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_End">
            <outcome>Fail</outcome>
            <sendStandardLetter>true</sendStandardLetter>
          </node>
        </li>

        <li Class="QuestNode_AddPawnReward">
          <pawn>$prisoner</pawn>
          <inSignalChoiceUsed>site.MapGenerated</inSignalChoiceUsed>
          <rewardDetailsHidden>false</rewardDetailsHidden>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
  <QuestScriptDef>
    <defName>HVMP_RescueeDowned</defName>
    <rootSelectionWeight>0</rootSelectionWeight>
    <rootMinPoints>0</rootMinPoints>
    <rootIncreasesPopulation>true</rootIncreasesPopulation>
    <autoAccept>true</autoAccept>
    <questNameRules>
      <rulesStrings>
        <li>questName->Saving [refugee_nameDef]</li>
        <li>questName->The Rescue of [refugee_nameDef]</li>
        <li>questName->[refugee_nameDef]'s Rescue</li>
        <li>questName->[refugee_nameDef]'s Salvation</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The Rover Branch has informed us of a wounded traveler's distress signal and last known location. The victim is [refugee_nameIndef], a [refugee_age]-year-old [refugee_title].
\nIf you can make it to [refugee_nameDef]'s position and rescue [refugee_objective], [refugee_pronoun] will join you.
\nThe E-branch contact says that [allSitePartsDescriptionsExceptFirst][pawnInvolvedInQuestInfo]</li>

        <li>pawnInvolvedInQuestInfo(priority=1)->[refugee_pawnInvolvedInQuestInfo]</li>
        <li>pawnInvolvedInQuestInfo-></li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap">
          <canBeSpace>true</canBeSpace>
        </li>
        <li Class="QuestNode_Set">
          <name>siteDistRange</name>
          <value>2~13</value>
        </li>
        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
          <selectLandmarkChance>0.5</selectLandmarkChance>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.7</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>DownedRefugee</tag>
            </li>
            <li>
              <tag>DownedRefugeeQuestThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
          <parms>
            <hiddenSitePartsPossible>true</hiddenSitePartsPossible>
          </parms>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(7,15)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">[refugee_nameDef]'s signal has been lost, and [refugee_pronoun] can no longer be rescued. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_AddPawnReward">
          <pawn>$refugee</pawn>
          <inSignalChoiceUsed>site.MapGenerated</inSignalChoiceUsed>
          <rewardDetailsHidden>false</rewardDetailsHidden>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
  <QuestScriptDef MayRequire="Ludeon.RimWorld.Anomaly">
    <defName>HVMP_DistressCall</defName>
    <rootSelectionWeight>0</rootSelectionWeight>
    <autoAccept>true</autoAccept>
    <isRootSpecial>true</isRootSpecial>
    <sendAvailableLetter>false</sendAvailableLetter>
    <questNameRules>
      <rulesStrings>
        <li>questName->Fleshmass infestation</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The Rover Branch warns of a fleshbeast attack that has overwhelmed a nearby camp of [faction_name]. It is too late to save the inhabitants, but you might still be able to recover valuable goods and technology from it.</li>
      </rulesStrings>
    </questDescriptionRules>
    <questDescriptionAndNameRules>
      <rulesStrings>
      </rulesStrings>
    </questDescriptionAndNameRules>
    <root Class="QuestNode_Root_DistressCall" />
  </QuestScriptDef>
	  <QuestScriptDef MayRequire="sarg.alphagenes">
		<defName>HVMP_AbandonedBiotechLab</defName>
		<rootSelectionWeight>0</rootSelectionWeight>
		<rootMinPoints>0</rootMinPoints>
		<autoAccept>true</autoAccept>
		<questNameRules>
		  <rulesStrings>
			<li>questName(priority=1)->[biotechlab] [discovered]</li>
			<li>biotechlab->Biotech lab</li>
			<li>biotechlab->Biotech genetics lab</li>
			<li>biotechlab->Biotech experimentation lab</li>
			<li>biotechlab->Biotech xenotype lab</li>
			<li>biotechlab->Biotech human genetics lab</li>
			<li>discovered->sighted</li>
			<li>discovered->found</li>
			<li>discovered->located</li>
			<li>discovered->brought to light</li>
			<li>discovered->tracked down</li>
			<li>discovered->unearthed</li>
		  </rulesStrings>
		</questNameRules>
		<questDescriptionRules>
		  <rulesStrings>
			<li>questDescription->The Rover Branch has informed us of an ancient Biotech lab not far from [map_definite]. The site may have some salvageable genetic technology, so it could be a good idea to investigate it.\n\nWe should be well prepared, as the radio beacon may attract a hostile presence to the lab's location.</li>
		  </rulesStrings>
		</questDescriptionRules>
		<root Class="QuestNode_Sequence">
		  <nodes>
			<li Class="QuestNode_SubScript">
			  <def>Util_GetDefaultRewardValueFromPoints</def>
			</li>
			<li Class="QuestNode_SubScript">
			  <def>Util_AdjustPointsForDistantFight</def>
			</li>
			<li Class="QuestNode_GetMap" />
			<li Class="QuestNode_Set">
			  <name>siteDistRange</name>
			  <value>2~13</value>
			</li>
			<li Class="QuestNode_GetSiteTile">
			  <storeAs>siteTile</storeAs>
			  <preferCloserTiles>true</preferCloserTiles>
			</li>

			<li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
			  <storeAs>sitePartDefs</storeAs>
			  <storeFactionAs>siteFaction</storeFactionAs>
			  <sitePartsTags>
				<li><tag>AG_AbandonedBiotechLab</tag></li>
			   
			  </sitePartsTags>
			</li>

			<li Class="QuestNode_GetDefaultSitePartsParams">
			  <tile>$siteTile</tile>
			  <faction>$siteFaction</faction>
			  <sitePartDefs>$sitePartDefs</sitePartDefs>
			  <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
			</li>

			<li Class="QuestNode_SubScript">
			  <def>Util_GenerateSite</def>
			  <parms>
				<hiddenSitePartsPossible>true</hiddenSitePartsPossible>
			  </parms>
			</li>

			<li Class="QuestNode_SpawnWorldObjects">
			  <worldObjects>$site</worldObjects>
			</li>

			<li Class="QuestNode_WorldObjectTimeout">
			  <worldObject>$site</worldObject>
			  <isQuestTimeout>true</isQuestTimeout>
			  <delayTicks>$(randInt(12,28)*60000)</delayTicks>
			  <inSignalDisable>site.MapGenerated</inSignalDisable>
			  <node Class="QuestNode_Sequence">
				<nodes>
				  <li Class="QuestNode_Letter">
					<label>Quest expired: [resolvedQuestName]</label>
					<text>Intercepted communications indicate the abandoned biotech lab has been scavenged by others. The quest [resolvedQuestName] has expired.</text>
				  </li>
				  <li Class="QuestNode_End">
					<outcome>Fail</outcome>
				  </li>
				</nodes>
			  </node>
			</li>

			<li Class="QuestNode_NoWorldObject">
			  <worldObject>$site</worldObject>
			  <node Class="QuestNode_End"></node>
			</li>
		  </nodes>
		</root>
	  </QuestScriptDef>
</Defs>